// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// Product Model - 제품 관리
model Product {
  id          String   @id @default(uuid())
  sku         String   @unique // 제품 고유 번호

  // 기본 정보 (한국어)
  nameKo      String
  descriptionKo String?

  // 영어
  nameEn      String
  descriptionEn String?

  // 아랍어
  nameAr      String?
  descriptionAr String?

  // 카테고리 및 브랜드
  category    ProductCategory
  brand       String // 3M, DeWALT, Makita, Bosch, EXACT 등

  // 가격 정보
  price       Float?
  currency    String @default("KRW")

  // 재고 정보
  stock       Int @default(0)
  isAvailable Boolean @default(true)

  // 이미지
  images      String? // JSON string of image URLs
  thumbnail   String?  // 대표 이미지

  // 사양 (JSON 형태로 저장)
  specifications String? // JSON string

  // 상태
  status      ProductStatus @default(ACTIVE)

  // 메타데이터
  tags        String? // JSON string of tags
  featured    Boolean @default(false) // 추천 제품 여부

  // 타임스탬프
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([category])
  @@index([brand])
  @@index([status])
}

enum ProductCategory {
  TAPE_ADHESIVE       // 3M 테이프 및 접착제
  ABRASIVE            // 3M 연마재
  SAFETY_EQUIPMENT    // 3M 안전보호구
  PIPE_CUTTING        // EXACT 파이프 커팅
  POWER_TOOLS         // 전동공구
  INDUSTRIAL_FILM     // 산업용 필름
  OTHER               // 기타
}

enum ProductStatus {
  ACTIVE      // 활성
  INACTIVE    // 비활성
  OUT_OF_STOCK // 품절
  DISCONTINUED // 단종
}

// Lead Model - AI Chatbot에서 수집한 리드 정보
model Lead {
  id          String   @id @default(uuid())

  // 세션 정보
  sessionId   String   @unique

  // 연락처 정보
  name        String?
  company     String?
  email       String?
  phone       String?
  country     String?

  // 문의 정보
  inquiryType String?  // b2b, quote, product, support, other
  message     String?

  // 대화 내역 (JSON)
  chatHistory String?  // JSON string of messages

  // 메타데이터
  source      String   @default("chatbot") // chatbot, contact_form, etc.
  status      LeadStatus @default(NEW)
  priority    LeadPriority @default(MEDIUM)

  // AI 분석
  aiSummary   String?  // AI가 생성한 리드 요약
  aiScore     Int?     // AI가 평가한 리드 점수 (0-100)

  // IP 및 위치 정보
  ipAddress   String?
  userAgent   String?
  locale      String?

  // 타임스탬프
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([status])
  @@index([createdAt])
  @@index([email])
}

enum LeadStatus {
  NEW         // 새로운 리드
  CONTACTED   // 연락됨
  QUALIFIED   // 자격 검증됨
  CONVERTED   // 전환됨 (고객화)
  LOST        // 상실
}

enum LeadPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

// Quote Request Model - AI 견적 시스템
model QuoteRequest {
  id          String   @id @default(uuid())

  // 세션 및 리드 연결
  sessionId   String?
  leadId      String?

  // 제품 정보
  productType String   // 3M, EXACT, etc.
  products    String?  // JSON array of requested products

  // 파이프 관련 (EXACT)
  pipeMaterial String? // steel, stainless, plastic
  pipeDiameter String? // e.g., "100-360mm"
  quantity     Int?

  // 추가 요구사항
  requirements String?

  // AI 생성 견적
  estimatedPriceMin Float?
  estimatedPriceMax Float?
  currency          String @default("USD")
  aiRecommendations String? // AI가 추천한 제품/모델

  // 연락처
  name        String?
  company     String?
  email       String?
  phone       String?
  country     String?

  // 상태
  status      QuoteStatus @default(PENDING)

  // 타임스탬프
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([status])
  @@index([createdAt])
}

enum QuoteStatus {
  PENDING     // 대기중
  PROCESSING  // 처리중
  SENT        // 발송됨
  ACCEPTED    // 수락됨
  REJECTED    // 거절됨
}
